
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Die ersten Views &mdash; Django 101 Tutorial</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="top" title="Django 101 Tutorial" href="../index.html" />
    <link rel="up" title="Erste Schritte mit Django" href="index.html" />
    <link rel="next" title="Rückblick und Ausblick" href="rueckblick_ausblick.html" />
    <link rel="prev" title="Datenbank und Entwicklungs-Webserver" href="datenbank.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Allgemeiner Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="rueckblick_ausblick.html" title="Rückblick und Ausblick"
             accesskey="N">weiter</a> |</li>
        <li class="right" >
          <a href="datenbank.html" title="Datenbank und Entwicklungs-Webserver"
             accesskey="P">zurück</a> |</li>
        <li><a href="../index.html">Django 101 Tutorial</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Erste Schritte mit Django</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="die-ersten-views">
<h1>Die ersten Views<a class="headerlink" href="#die-ersten-views" title="Permalink zu dieser Überschrift">¶</a></h1>
<p>Nachdem du nun einige Datensätze mit Hilfe der Admins-Applikation angelegt
hast ist der nächste Schritt, diese auch im Frontend anzuzeigen. Dazu musst du
drei Dinge tun:</p>
<blockquote>
<div><ol class="arabic simple">
<li>URLs definieren</li>
<li>Views schreiben</li>
<li>Templates erstellen</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Bemerkung</p>
<p class="last">Siehe <a class="reference internal" href="../einfuehrung.html#grafik-request-response"><em>Grafik: Schematische Darstellung einer Request / Response
Verarbeitung</em></a></p>
</div>
<div class="section" id="urls-definieren">
<h2>URLs definieren<a class="headerlink" href="#urls-definieren" title="Permalink zu dieser Überschrift">¶</a></h2>
<p>Zuerst definieren wir die URLs, die zum Abruf der verschiedenen Views dienen
sollen. Fürs Erste wollen wir zwei URLs anlegen. Öffne dazu die Datei
<tt class="file docutils literal"><span class="pre">urls.py</span></tt> und füge am Ende der <tt class="docutils literal"><span class="pre">urlpatterns</span></tt> die folgenden beiden
Zeilen ein:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">url</span><span class="p">(</span><span class="s">r&#39;^rezept/(?P&lt;slug&gt;[-\w]+)/$&#39;</span><span class="p">,</span> <span class="s">&#39;recipes.views.detail&#39;</span><span class="p">),</span>
<span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;recipes.views.index&#39;</span><span class="p">),</span>
</pre></div>
</div>
<p>Die Zeile unseres ersten Templates kannst du wieder entfernen, sie wird nicht mehr benötigt:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">url</span><span class="p">(</span><span class="s">r&#39;^home/&#39;</span><span class="p">,</span> <span class="n">TemplateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s">&#39;base.html&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Die Datei <tt class="file docutils literal"><span class="pre">urls.py</span></tt> sieht danach so aus:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.views.generic.base</span> <span class="kn">import</span> <span class="n">TemplateView</span>

<span class="c"># Uncomment the next two lines to enable the admin:</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="n">admin</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="c"># Examples:</span>
    <span class="c"># url(r&#39;^$&#39;, &#39;cookbook.views.home&#39;, name=&#39;home&#39;),</span>
    <span class="c"># url(r&#39;^cookbook/&#39;, include(&#39;cookbook.foo.urls&#39;)),</span>

    <span class="c"># Uncomment the admin/doc line below to enable admin documentation:</span>
    <span class="c"># url(r&#39;^admin/doc/&#39;, include(&#39;django.contrib.admindocs.urls&#39;)),</span>

    <span class="c"># Uncomment the next line to enable the admin:</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^rezept/(?P&lt;slug&gt;[-\w]+)/$&#39;</span><span class="p">,</span> <span class="s">&#39;recipes.views.detail&#39;</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="s">&#39;recipes.views.index&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Bemerkung</p>
<p>Das erste Argument der <tt class="docutils literal"><span class="pre">url</span></tt> Funktion ist ein <a class="reference external" href="http://docs.python.org/reference/lexical_analysis.html#string-literals">Raw-String</a>,
der einen regulären Ausdruck enthält.</p>
<p class="last">Falls du regulären Ausdrücken zum ersten Mal begegnest kannst du mehr
darüber im <a class="reference external" href="http://docs.python.org/howto/regex.html">Regular-Expression-HOWTO</a>, auf <a class="reference external" href="http://www.regular-expressions.info/">Regular-Expressions.info</a> oder im Artikel von Doug Hellmann
über das <a class="reference external" href="http://www.doughellmann.com/PyMOTW/re/">re-Modul</a> erfahren. Auf <a class="reference external" href="http://www.regexplanet.com/advanced/python/index.html">RegexPlanet</a> kannst du reguläre Ausdrücke
direkt im Browser testen.</p>
</div>
<p>Nun startest du den Entwicklungs-Webserver:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python manage.py runserver
Validating models...
0 errors found

Django version 1.4, using settings <span class="s1">&#39;cookbook.settings&#39;</span>
Development server is running at http://127.0.0.1:8000/
Quit the server with CONTROL-C.
</pre></div>
</div>
<p>Der Aufruf der URL <a class="reference external" href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> zeigt eine <tt class="docutils literal"><span class="pre">ViewDoesNotExist</span></tt>
Exception. Das ist auch richtig so, denn bis jetzt hast du ja noch keinen View
geschrieben. Es zeigt aber, dass dein URL funktioniert.</p>
</div>
<div class="section" id="wie-wird-ein-template-gerendert">
<h2>Wie wird ein Template gerendert?<a class="headerlink" href="#wie-wird-ein-template-gerendert" title="Permalink zu dieser Überschrift">¶</a></h2>
<p>Bevor wir die ersten Views schreiben wollen wir uns ansehen wie Django
Templates gerendert werden.</p>
<p>Django Templates sind einfache Python Objekte, deren Konstruktor einen String
erwartet. Mit Hilfe eines Context Objekts werden dann die Platzhalter im
Template durch die gewünschten Werte ersetzt.</p>
<p>Das erste Beispiel zeigt wie man ein Dictionary als Datenstruktur nutzen
kann</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python manage.py shell
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Bemerkung</p>
<p class="last">Der Befehl <strong class="program">shell</strong> lädt die Einstellungen aus <tt class="file docutils literal"><span class="pre">settings.py</span></tt>
für das aktuelle Projekt, was beim Start durch die Eingabe von
<strong class="program">python</strong> nicht passieren würde.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">Template</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;Mein Name ist {{ person.first_name }}.&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;person&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;first_name&#39;</span><span class="p">:</span> <span class="s">&#39;Andi&#39;</span><span class="p">}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">Context</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
<span class="go">u&#39;Mein Name ist Andi.&#39;</span>
</pre></div>
</div>
<p>Im zweiten Beispiel nutzen wir ein einfaches Python Objekt als Datenstruktur:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span> <span class="k">pass</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="s">&#39;Klara&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;person&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">u&#39;Mein Name ist Klara.&#39;</span>
</pre></div>
</div>
<p>Listen können ebenfalls genutzt werden:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">&#39;Erster Artikel: {{ articles.0 }}&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;articles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;Brot&#39;</span><span class="p">,</span> <span class="s">&#39;Eier&#39;</span><span class="p">,</span> <span class="s">&#39;Milch&#39;</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">u&#39;Erster Artikel: Brot&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="den-ersten-view-schreiben">
<h2>Den ersten View schreiben<a class="headerlink" href="#den-ersten-view-schreiben" title="Permalink zu dieser Überschrift">¶</a></h2>
<p>Also müssen nun die Views erstellt werden. Sie sollen die Daten, die angezeigt
werden sollen, mit Hilfe des ORMs aus der Datenbank holen.</p>
<p>Dazu öffnest du die Datei <tt class="file docutils literal"><span class="pre">views.py</span></tt> in der Applikation <tt class="docutils literal"><span class="pre">recipes</span></tt>, die
durch das Kommando <strong class="command">startapp recipes</strong> angelegt wurde.</p>
<p>Die meisten Views geben ein <tt class="docutils literal"><span class="pre">HttpResponse</span></tt> Objekt zurück. Also schreiben wir
einen ganz einfachen View, der dies tut:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>


<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&#39;Mein erster View.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Nachdem du den View gespeichert hast rufst du <a class="reference external" href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> auf und
wirst den String sehen, den du dem <tt class="docutils literal"><span class="pre">HttpResponse</span></tt> Objekt übergeben hast. Ein
<tt class="docutils literal"><span class="pre">HttpResponse</span></tt> erwartet also immer einen String.</p>
<p>Nun werden wir statt des Strings ein <tt class="docutils literal"><span class="pre">Template</span></tt> laden und dieses mit einem
<tt class="docutils literal"><span class="pre">Context</span></tt> rendern, der ein <tt class="docutils literal"><span class="pre">Recipe</span></tt> Objekt enthält. Der <tt class="docutils literal"><span class="pre">HttpResponse</span></tt>
wird dann den vom <tt class="docutils literal"><span class="pre">Template</span></tt> gerenderten String zurück geben:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">loader</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Recipe</span>


<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">recipes</span> <span class="o">=</span> <span class="n">Recipe</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s">&#39;recipes/index.html&#39;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;object_list&#39;</span><span class="p">:</span> <span class="n">recipes</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</pre></div>
</div>
<p>Wenn du nun <a class="reference external" href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> aufrufst wird eine <tt class="docutils literal"><span class="pre">TemplateDoesNotExist</span></tt>
Exception ausgelöst. Klar - du hast das geladene Template auch noch nicht
erstellt.</p>
</div>
<div class="section" id="templates-erstellen">
<h2>Templates erstellen<a class="headerlink" href="#templates-erstellen" title="Permalink zu dieser Überschrift">¶</a></h2>
<p>Öffne die Datei <tt class="file docutils literal"><span class="pre">base.html</span></tt>: aus dem Verzeichnis <tt class="file docutils literal"><span class="pre">templates</span></tt> und ändere sie wie folgt ab:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}</span>Kochbuch<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Kochbuch<span class="nt">&lt;/h1&gt;</span>
    <span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Sie enthält nun zwei <strong>Blöcke</strong>. Diese werden von den anderen Templates
gefüllt, die von diesem Template ableiten.</p>
<p>Innerhalb der Applikation musst du auch zwei Verzeichnisse für die Templates
anlegen, nämlich <tt class="file docutils literal"><span class="pre">recipes/templates/recipes</span></tt>. Darin erstellt du die
Datei <tt class="file docutils literal"><span class="pre">index.html</span></tt>:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{{</span> <span class="nb">block</span><span class="nv">.super</span> <span class="cp">}}</span> - Alle Rezepte<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="nt">&lt;h2&gt;</span>Alle Rezepte<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;ul&gt;</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">recipe</span> <span class="k">in</span> <span class="nv">object_list</span> <span class="cp">%}</span>
    <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;/rezept/</span><span class="cp">{{</span> <span class="nv">recipe.slug</span> <span class="cp">}}</span><span class="s">/&quot;</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">recipe.title</span> <span class="cp">}}</span><span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="nt">&lt;/ul&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Jetzt sollte deine Verzeichnisstruktur wie folgt aussehen:</p>
<div class="highlight-none"><div class="highlight"><pre>cookbook
|-- cookbook
|   |-- __init__.py
|   |-- settings.py
|   |-- urls.py
|   `-- wsgi.py
|-- cookbook.db
|-- manage.py
|-- recipes
|   |-- __init__.py
|   |-- admin.py
|   |-- fixtures
|   |   `-- initial_data.json
|   |-- models.py
|   |-- templates
|   |   `-- recipes
|   |       `-- index.html
|   |-- tests.py
|   `-- views.py
`-- templates
    `-- base.html
</pre></div>
</div>
<p>Nachdem du den Entwicklungs-Webserver neu gestartet hast solltest du nun eine
Liste aller Rezepte sehen, wenn du <a class="reference external" href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a> aufrufst.</p>
</div>
<div class="section" id="den-zweiten-view-hinzufugen">
<h2>Den zweiten View hinzufügen<a class="headerlink" href="#den-zweiten-view-hinzufugen" title="Permalink zu dieser Überschrift">¶</a></h2>
<p>Damit auch die Detailansicht der Rezepte funktioniert, muss ein zweiter View
geschrieben werden.</p>
<p>Als erstes muss ein zusätzlicher Import an den Beginn der Datei
<tt class="file docutils literal"><span class="pre">views.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">Http404</span>
</pre></div>
</div>
<p>An das Ende kommt eine neue Methode für den neuen View:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">slug</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="n">Recipe</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Recipe</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Http404</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s">&#39;recipes/detail.html&#39;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;object&#39;</span><span class="p">:</span> <span class="n">recipe</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</pre></div>
</div>
<p>Die komplette Datei sieht dann so aus:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">Http404</span><span class="p">,</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.template</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">loader</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Recipe</span>


<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">recipes</span> <span class="o">=</span> <span class="n">Recipe</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s">&#39;recipes/index.html&#39;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;object_list&#39;</span><span class="p">:</span> <span class="n">recipes</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">slug</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">recipe</span> <span class="o">=</span> <span class="n">Recipe</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">slug</span><span class="o">=</span><span class="n">slug</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Recipe</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Http404</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s">&#39;recipes/detail.html&#39;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">Context</span><span class="p">({</span><span class="s">&#39;object&#39;</span><span class="p">:</span> <span class="n">recipe</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="ein-zweites-template-erstellen">
<h2>Ein zweites Template erstellen<a class="headerlink" href="#ein-zweites-template-erstellen" title="Permalink zu dieser Überschrift">¶</a></h2>
<p>Nun fehlt nur noch das zweite Template <tt class="file docutils literal"><span class="pre">recipes/detail.html</span></tt>. Lege es im
gleichen Verzeichnis wie auch <tt class="file docutils literal"><span class="pre">recipes/index.html</span></tt> an:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">title</span> <span class="cp">%}{{</span> <span class="nb">block</span><span class="nv">.super</span> <span class="cp">}}</span> - <span class="cp">{{</span> <span class="nv">object.title</span> <span class="cp">}}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="nt">&lt;h2&gt;</span><span class="cp">{{</span> <span class="nv">object.title</span> <span class="cp">}}</span><span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;p&gt;</span>Ergibt <span class="cp">{{</span> <span class="nv">object.number_of_portions</span> <span class="cp">}}</span> Portionen.<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;h3&gt;</span>Zutaten<span class="nt">&lt;/h3&gt;</span>
<span class="cp">{{</span> <span class="nv">object.ingredients</span><span class="o">|</span><span class="nf">linebreaks</span> <span class="cp">}}</span>
<span class="nt">&lt;h3&gt;</span>Zubereitung<span class="nt">&lt;/h3&gt;</span>
<span class="cp">{{</span> <span class="nv">object.preparation</span><span class="o">|</span><span class="nf">linebreaks</span> <span class="cp">}}</span>
<span class="nt">&lt;p&gt;</span>Zubereitungszeit: <span class="cp">{{</span> <span class="nv">object.time_for_preparation</span> <span class="cp">}}</span> Minuten<span class="nt">&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Jetzt kannst du auch alle Rezepte ansehen, indem du auf die Links auf der
Startseite klickst.</p>
</div>
<div class="section" id="warum-versteckt-die-template-engine-variablen-die-nicht-existieren">
<h2>Warum versteckt die Template Engine Variablen, die nicht existieren?<a class="headerlink" href="#warum-versteckt-die-template-engine-variablen-die-nicht-existieren" title="Permalink zu dieser Überschrift">¶</a></h2>
<p>Wenn eine Variable nicht als Schlüssel im Context definiert wurde, wird diese
im Template von der Django Template Engine ignoriert. Dies ist vor allem im
Produktivbetrieb sinnvoll, da so die Seite trotz einer fehlenden Variable noch
gerendert werden kann.</p>
<p>Um trotzdem zu sehen, ob eine Variable nicht gerendert wurde, kann man in der
Konfiguration <tt class="file docutils literal"><span class="pre">settings.py</span></tt> eine Zeichenkette definieren, die in diesem
Fall ausgegeben wird:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">TEMPLATE_STRING_IF_INVALID</span> <span class="o">=</span> <span class="s">&#39;TEMPLATE NAME ERROR&#39;</span>
</pre></div>
</div>
<p>Diese Einstellung sollte im Produktivbetrieb aber wieder deaktiviert werden.</p>
</div>
<div class="section" id="maskierung-von-html-und-javascript">
<h2>Maskierung von HTML und JavaScript<a class="headerlink" href="#maskierung-von-html-und-javascript" title="Permalink zu dieser Überschrift">¶</a></h2>
<p>Aus Sicherheitsgründen maskiert die Django Template Engine alles HTML und
JavaScript, dass sich im Context befindet. Nehmen wir an, ein Benutzer schreibt in das
Feld &#8220;Zubereitung&#8221; seines Rezepts folgenden Text</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;script&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Das beste Rezept der Welt!&#39;</span><span class="p">)</span><span class="nt">&lt;/script&gt;</span>
Das Wasser im Topf auf 100°C erhitzen.
</pre></div>
</div>
<p>Dann würde dieses HTML erzeugt</p>
<div class="highlight-html"><pre>&lt;p&gt;&amp;lt;script&amp;gt;alert(&amp;#39;Das beste Rezept der &lt;Welt!&amp;#39;)&amp;lt;/script&amp;gt;&lt;/p&gt;
&lt;p&gt;Das Wasser im Topf auf 100°C erhitzen.&lt;/p&gt;</pre>
</div>
<p>Der JavaScript Code würde also nicht ausgeführt werden.</p>
<p>Es ist auch möglch, HTML Tags komplett zu entfernen. Dazu müsstest du im
Template zusätzlich den <tt class="docutils literal"><span class="pre">striptags</span></tt> Filter einsetzen:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="nt">&lt;h2&gt;</span><span class="cp">{{</span> <span class="nv">object.title</span> <span class="cp">}}</span><span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;p&gt;</span>Ergibt <span class="cp">{{</span> <span class="nv">object.number_of_portions</span> <span class="cp">}}</span> Portionen.<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;h3&gt;</span>Zutaten<span class="nt">&lt;/h3&gt;</span>
<span class="cp">{{</span> <span class="nv">object.ingredients</span><span class="o">|</span><span class="nf">linebreaks</span> <span class="cp">}}</span>
<span class="nt">&lt;h3&gt;</span>Zubereitung<span class="nt">&lt;/h3&gt;</span>
<span class="cp">{{</span> <span class="nv">object.preparation</span><span class="o">|</span><span class="nf">striptags</span><span class="o">|</span><span class="nf">linebreaks</span> <span class="cp">}}</span>
<span class="nt">&lt;p&gt;</span>Zubereitungszeit: <span class="cp">{{</span> <span class="nv">object.time_for_preparation</span> <span class="cp">}}</span> Minuten<span class="nt">&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Jetzt sieht das HTML so aus</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;p&gt;</span>alert(<span class="ni">&amp;#39;</span>Das beste Rezept der Welt!<span class="ni">&amp;#39;</span>)<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>Das Wasser im Topf auf 100°C erhitzen.<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div>
<p>Bist du dir dagegen sicher, dass HTML oder JavaScript gerendet und ggf.
ausgeführt werden soll, kannst du den <tt class="docutils literal"><span class="pre">safe</span></tt> Filter benutzen, um dies
explizit zu erlauben:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>
<span class="nt">&lt;h2&gt;</span><span class="cp">{{</span> <span class="nv">object.title</span> <span class="cp">}}</span><span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;p&gt;</span>Ergibt <span class="cp">{{</span> <span class="nv">object.number_of_portions</span> <span class="cp">}}</span> Portionen.<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;h3&gt;</span>Zutaten<span class="nt">&lt;/h3&gt;</span>
<span class="cp">{{</span> <span class="nv">object.ingredients</span><span class="o">|</span><span class="nf">linebreaks</span> <span class="cp">}}</span>
<span class="nt">&lt;h3&gt;</span>Zubereitung<span class="nt">&lt;/h3&gt;</span>
<span class="cp">{{</span> <span class="nv">object.preparation</span><span class="o">|</span><span class="nf">safe</span><span class="o">|</span><span class="nf">linebreaks</span> <span class="cp">}}</span>
<span class="nt">&lt;p&gt;</span>Zubereitungszeit: <span class="cp">{{</span> <span class="nv">object.time_for_preparation</span> <span class="cp">}}</span> Minuten<span class="nt">&lt;/p&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Jetzt wird tatsächlich das JavaScript wie vom Benutzer gewünscht ausgeführt</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;p&gt;&lt;script&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Das beste Rezept der Welt!&#39;</span><span class="p">)</span><span class="nt">&lt;/script&gt;&lt;/p&gt;</span>
<span class="nt">&lt;p&gt;</span>Das Wasser im Topf auf 100°C erhitzen.<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Bemerkung</p>
<p class="last">Dies ermögicht natürlich <a class="reference external" href="https://de.wikipedia.org/wiki/Cross-Site-Scripting">XSS-Angriffe</a> und sollte deshalb mit größter
Vorsicht eingesetzt werden.</p>
</div>
</div>
<div class="section" id="weiterfuhrende-links-zur-django-dokumentation">
<h2>Weiterführende Links zur Django Dokumentation<a class="headerlink" href="#weiterfuhrende-links-zur-django-dokumentation" title="Permalink zu dieser Überschrift">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://docs.djangoproject.com/en/1.4/topics/http/urls/#topics-http-urls">Der URL dispatcher</a></li>
<li><a class="reference external" href="https://docs.djangoproject.com/en/1.4/topics/http/views/#topics-http-views">Views schreiben</a></li>
<li><a class="reference external" href="https://docs.djangoproject.com/en/1.4/topics/templates/#topics-templates">Templates und deren Vererbung</a></li>
<li><a class="reference external" href="https://docs.djangoproject.com/en/1.4/topics/templates/#automatic-html-escaping">Automatische Maskierung von HTML und JavaScript</a></li>
<li><a class="reference external" href="https://docs.djangoproject.com/en/1.4/ref/templates/api/">Django Templates für Python Programmierer</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Inhalt</a></h3>
  <ul>
<li><a class="reference internal" href="#">Die ersten Views</a><ul>
<li><a class="reference internal" href="#urls-definieren">URLs definieren</a></li>
<li><a class="reference internal" href="#wie-wird-ein-template-gerendert">Wie wird ein Template gerendert?</a></li>
<li><a class="reference internal" href="#den-ersten-view-schreiben">Den ersten View schreiben</a></li>
<li><a class="reference internal" href="#templates-erstellen">Templates erstellen</a></li>
<li><a class="reference internal" href="#den-zweiten-view-hinzufugen">Den zweiten View hinzufügen</a></li>
<li><a class="reference internal" href="#ein-zweites-template-erstellen">Ein zweites Template erstellen</a></li>
<li><a class="reference internal" href="#warum-versteckt-die-template-engine-variablen-die-nicht-existieren">Warum versteckt die Template Engine Variablen, die nicht existieren?</a></li>
<li><a class="reference internal" href="#maskierung-von-html-und-javascript">Maskierung von HTML und JavaScript</a></li>
<li><a class="reference internal" href="#weiterfuhrende-links-zur-django-dokumentation">Weiterführende Links zur Django Dokumentation</a></li>
</ul>
</li>
</ul>

  <h4>Vorheriges Thema</h4>
  <p class="topless"><a href="datenbank.html"
                        title="vorheriges Kapitel">Datenbank und Entwicklungs-Webserver</a></p>
  <h4>Nächstes Thema</h4>
  <p class="topless"><a href="rueckblick_ausblick.html"
                        title="nächstes Kapitel">Rückblick und Ausblick</a></p>
  <h3>Diese Seite</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/erste_schritte/views_templates.txt"
           rel="nofollow">Quelltext anzeigen</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Schnellsuche</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Los" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Geben Sie Suchbegriffe oder einen Modul-, Klassen- oder Funktionsnamen ein.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Allgemeiner Index"
             >Index</a></li>
        <li class="right" >
          <a href="rueckblick_ausblick.html" title="Rückblick und Ausblick"
             >weiter</a> |</li>
        <li class="right" >
          <a href="datenbank.html" title="Datenbank und Entwicklungs-Webserver"
             >zurück</a> |</li>
        <li><a href="../index.html">Django 101 Tutorial</a> &raquo;</li>
          <li><a href="index.html" >Erste Schritte mit Django</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright .
    <br />Dieses Werk ist unter einem <a href="http://creativecommons.org/licenses/by-sa/3.0/de/">Creative Commons Namensnennung-Weitergabe unter gleichen Bedingungen 3.0 Deutschland Lizenzvertrag</a> lizenziert.<br />
      Mit <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3 erstellt.
    </div>
  </body>
</html>